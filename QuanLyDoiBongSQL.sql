CREATE DATABASE FMANAGEMENT;
CREATE TABLE Hopdong(
    SOHD CHAR(5) NOT NULL PRIMARY KEY, 
    MUCLUONG INT NOT NULL, 
    NGAYKYKET DATE NOT NULL, 
    NGAYDENHAN DATE NOT NULL,
	CONSTRAINT CHK CHECK(NGAYDENHAN > NGAYKYKET)
);
CREATE TABLE NhanSu(
	MASONS CHAR(5) NOT NULL PRIMARY KEY,
	HOTEN CHAR(50) NOT NULL, 
	NGAYSINH DATE NOT NULL, 
	PHAI CHAR(3) NOT NULL, 
	QUOCTICH CHAR(50) NOT NULL,
    SOHD CHAR(5) NOT NULL,

    FOREIGN KEY(SOHD) REFERENCES Hopdong(SOHD)
);
CREATE TABLE BanLanhDao(
    ID_BLD CHAR(5) NOT NULL PRIMARY KEY,
    MASONS CHAR(5) NOT NULL,
    CHUCVI CHAR(100) NOT NULL,
    NGAYNHANCHUC DATE NOT NULL,

    FOREIGN KEY(MASONS) REFERENCES NhanSu(MASONS),
    NHIEMKY INT CHECK(NHIEMKY > 0)
);
CREATE TABLE BanHuanLuyen(
    ID_BHL CHAR(5) NOT NULL PRIMARY KEY,
    MASONS CHAR(5) NOT NULL,
    VAITRO CHAR(30) NOT NULL,

    FOREIGN KEY(MASONS) REFERENCES NhanSu(MASONS)
   );
CREATE TABLE CauThu(
    ID_CT CHAR(5) NOT NULL PRIMARY KEY,
    SOHD CHAR(5) NOT NULL,
    HOTEN CHAR(50) NOT NULL, 
    NGAYSINH DATE NOT NULL, 
    QUOCTICH CHAR(50), 
    SOAO INT NOT NULL,  
    BANTHANG INT NOT NULL, 
    KIENTAO INT NOT NULL, 
    
    FOREIGN KEY(SOHD) REFERENCES Hopdong(SOHD),
    CHECK(SOAO > 0 AND BANTHANG >=0 AND KIENTAO >=0 )
);
CREATE TABLE CauThu_ViTri(
    ID_CT CHAR(5) NOT NULL,
    VITRI CHAR(2) NOT NULL,
    PRIMARY KEY(ID_CT, VITRI),
    FOREIGN KEY(ID_CT) REFERENCES Cauthu(ID_CT)
);
CREATE TABLE Huanluyen(
    ID_BHL CHAR(5) NOT NULL, 
    ID_CT CHAR(5) NOT NULL, 
    NOIDUNG CHAR(50) NOT NULL, 
    
    PRIMARY KEY(ID_BHL, ID_CT),
    FOREIGN KEY(ID_BHL) REFERENCES BanHuanLuyen(ID_BHL),
    FOREIGN KEY(ID_CT) REFERENCES CauThu(ID_CT)
);

CREATE TABLE Thanhtich (
    ID_ACHIE CHAR(5) NOT NULL PRIMARY KEY, 
    TENGIAITHUONG CHAR(100) NOT NULL, 
    NGAYNHANGIAI DATE NOT NULL, 
    ID_CT CHAR(5) NOT NULL,
    
    FOREIGN KEY(ID_CT) REFERENCES CauThu(ID_CT)
);
CREATE TABLE Chuyennhuong (
    MATHUONGVU CHAR(5) NOT NULL PRIMARY KEY, 
    GIATRI INT NOT NULL, 
    LOAICHUYENNHUONG CHAR(50) NOT NULL, 
    NGAYHIEULUC DATE NOT NULL,
    DOITAC CHAR(50) NOT NULL,
    ID_CT CHAR(5) NOT NULL,
  
    FOREIGN KEY(ID_CT) REFERENCES CauThu(ID_CT),
    CHECK(GIATRI >=0)
);
-- Đổ dữ liệu

-- Cập nhật danh sách cầu thủ
INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11704','300000','2016-06-12','2022-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT105','11704','Robert Lewandowski','1989-6-17','Poland','09','34','4');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT105','CF');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11725','250000','2018-06-12','2024-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT101','11725','Joshua Kimmich','1995-4-27','Germany','06','4','12');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT101','RB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT101','CM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT101','DM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11683','180000','2017-06-01','2023-06-01');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('GK001','11683','Manuel Neuer','1986-8-7','Germany','01','0','0');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('GK001','GK');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11013','20000','2020-06-01','2024-06-01');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('GK013','11013','Alexander Nubel','1998-8-7','Germany','13','0','0');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('GK013','GK');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('10111','275000','2020-07-01','2026-07-01');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT174','10111','Leon Goretzka','1995-3-12','Germany','08','12','9');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT174','CM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11101','250000','2020-06-12','2025-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT119','11101','Leroy Sane','1997-8-16','Germany','10','24','17');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT119','LW');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT119','LM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('10204','75000','2018-06-01','2023-06-01');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT476','10204','Alphonso Davies','2000-12-07','Canada','19','4','12');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT476','LB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT476','LB');
--
INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11002','70000','2021-06-12','2026-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT002','11002','Dayot Upamecano','1998-6-12','France','02','2','4');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT002','CB');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11004','85000','2017-06-12','2022-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT004','11004','Nicklas Sule','1995-10-15','Germany','04','2','4');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT004','CB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT004','RB');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11005','55000','2019-06-12','2024-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT005','11005','Benjamin Pavard','1995-2-26','France','05','6','8');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT005','CB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT005','RB');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11007','125000','2017-06-12','2023-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT007','11007','Serge Gnabry','1995-8-3','Germany','07','14','12');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT007','LM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT007','RM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11011','150000','2021-06-12','2025-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT011','11007','Kingley Coman','1995-12-14','France','11','12','17');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT011','LM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT011','RM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11021','125000','2019-06-12','2024-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT021','11021','Lucas Hernandez','1995-9-12','France','21','4','2');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT021','LB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT021','CB');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11012','200000','2022-06-12','2026-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT012','11012','Sadio Mane','1992-4-18','Senegal','12','18','21');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT012','LM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT012','RM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT012','LW');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11025','125000','2022-06-12','2024-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT025','11025','Thomas Muller','1989-9-13','France','25','14','22');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT025','AM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT025','SS');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11042','25000','2019-06-12','2024-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT042','11042','Jamal Musiala','2003-4-2','Germany','42','11','14');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT042','AM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT042','CM');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11023','20000','2019-06-12','2025-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT023','11023','Tanguy Nianzou Kouassi','2002-6-7','France','23','1','6');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT023','RB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT023','CB');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11014','90000','2021-06-12','2023-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT014','11014','Choupo Moting','1989-3-11','Cameroon','14','11','6');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT014','CF');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11017','100000','2022-06-12','2025-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT017','11017','Cristiano Ronaldo','1985-2-5','Portugal','17','31','16');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT017','CF');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('11018','125000','2021-06-12','2026-06-12');
INSERT INTO cauthu(ID_CT, SOHD, HOTEN, NGAYSINH, QUOCTICH, SOAO, BANTHANG, KIENTAO)
    VALUES ('CT018','11018','Marcel Sabitzer','1994-3-17','Austria','18','6','12');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT018','LB');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT018','CM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT018','AM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT018','RM');
INSERT INTO cauthu_vitri(ID_CT, VITRI) VALUES ('CT018','LM');

-- Cập nhật danh sách BHL
INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('50674','45000','2018-06-01','2023-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('M1101','Julian Nagelsmann','1987-04-06','Nam','Germany', '50674');
INSERT INTO banhuanluyen(ID_BHL, MASONS, VAITRO) VALUES ('11500','M1101','HLV Truong');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('0824','15000','2018-06-01','2023-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('M0901','Otal Kroos','1981-04-06','Nam','Germany', '0824');
INSERT INTO banhuanluyen(ID_BHL, MASONS, VAITRO) VALUES ('11512','M0901','Tro Ly HLV');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('0825','13500','2018-06-01','2023-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('M0902','Kevinn Phillip','1990-03-16','Nam','Croatia', '0825');
INSERT INTO banhuanluyen(ID_BHL, MASONS, VAITRO) VALUES ('11174','M0902','HLV Thu Mon');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('0826','23500','2018-06-01','2023-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('M0903','Josep Callas','1985-03-16','Nam','Croatia', '0826');
INSERT INTO banhuanluyen(ID_BHL, MASONS, VAITRO) VALUES ('11175','M0903','HLV The Luc');

-- Cập nhật danh sách BLĐ
INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('B111','1000000','2020-06-01','2028-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('B1001','Herbert Hainer','1963-03-16','Nam','Germany', 'B111');
INSERT INTO banlanhdao(ID_BLD, MASONS, CHUCVI, NGAYNHANCHUC, NHIEMKY) 
    VALUES ('99675','B1001','Chu Tich','2022-01-01','5');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('B112','500000','2021-06-01','2028-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('B1002','Olivier Kahn','1971-10-24','Nam','Germany', 'B112');
INSERT INTO banlanhdao(ID_BLD, MASONS, CHUCVI, NGAYNHANCHUC, NHIEMKY) 
    VALUES ('99676','B1002','Giam Doc Dieu Hanh','2022-01-01','5');

INSERT INTO hopdong(SOHD, MUCLUONG, NGAYKYKET, NGAYDENHAN) VALUES ('B113','300000','2018-06-01','2025-06-01');
INSERT INTO nhansu(MASONS, HOTEN, NGAYSINH, PHAI, QUOCTICH, SOHD) 
VALUES ('B1003','Hasan Salihamidzic','1977-01-01','Nam','Bosnia', 'B113');
INSERT INTO banlanhdao(ID_BLD, MASONS, CHUCVI, NGAYNHANCHUC, NHIEMKY) 
    VALUES ('99677','B1003','Giam Doc The Thao','2019-01-01','5');

INSERT INTO chuyennhuong(MATHUONGVU, GIATRI, LOAICHUYENNHUONG, NGAYHIEULUC, DOITAC, ID_CT) 
VALUES ('TR101','60000000','Ban','2022-06-01','Barcelona','CT105');
INSERT INTO chuyennhuong(MATHUONGVU, GIATRI, LOAICHUYENNHUONG, NGAYHIEULUC, DOITAC, ID_CT) 
VALUES ('TR102','40000000','Mua','2022-06-01','Liverpool','CT012');

INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11500','CT105','Chien Thuat');
INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11500','CT101','Chien Thuat');
INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11500','CT119','Chien Thuat');
INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11500','CT174','Chien Thuat');
INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11500','GK001','Chien Thuat');
INSERT INTO huanluyen(ID_BHL, ID_CT, NOIDUNG) VALUES ('11174','GK001','Bat Bong');

INSERT INTO thanhtich(ID_ACHIE, TENGIAITHUONG, NGAYNHANGIAI, ID_CT) VALUES ('AC001','FIFA THE BEST','2020-11-14','CT105');
INSERT INTO thanhtich(ID_ACHIE, TENGIAITHUONG, NGAYNHANGIAI, ID_CT) VALUES ('AC002','UEFA Player Of The Year','2020-11-14','CT105');
INSERT INTO thanhtich(ID_ACHIE, TENGIAITHUONG, NGAYNHANGIAI, ID_CT) VALUES ('AC003','UEFA Defender Of The Year','2020-11-14','CT101');
INSERT INTO thanhtich(ID_ACHIE, TENGIAITHUONG, NGAYNHANGIAI, ID_CT) VALUES ('AC004','UEFA Goalkeeper Of The Year','2020-11-14','GK001');

-- Truy vấn
--Lấy ra thông tin của chủ tịch CLB hiện tại
SELECT * FROM NhanSu, BanLanhDao, Hopdong WHERE NhanSu.MASONS = BanLanhDao.MASONS AND Hopdong.SOHD = NhanSu.SOHD AND CHUCVI = 'Chu Tich'
-- In ra danh sách cầu thủ thuộc biên chế đội bóng, thông tin gồm thông số cá nhân và trình trạng hợp đồng và sắp xếp theo số áo tăng dần
SELECT * FROM CauThu, Hopdong WHERE CauThu.SOHD = Hopdong.SOHD ORDER BY SOAO;
-- Lấy ra những cầu thủ có cùng vị trí với cầu thủ "Joshua Kimmich" để thay thế khi chấn thương
SELECT CauThu.*, CauThu_ViTri.VITRI FROM CauThu, CauThu_ViTri WHERE CauThu.ID_CT = CauThu_ViTri.ID_CT AND HOTEN != 'Joshua Kimmich' AND VITRI IN (SELECT VITRI FROM CauThu, CauThu_ViTri WHERE CauThu.ID_CT = CauThu_ViTri.ID_CT AND HOTEN = 'Joshua Kimmich');
-- Lấy ra cầu thủ người Đức ghi được nhiều bàn nhất mà chưa đạt danh hiệu cá nhân nào
use BaiTapLon
SELECT HOTEN, BANTHANG FROM CauThu WHERE BANTHANG = (SELECT MAX(BANTHANG) MAXGOAL FROM CauThu WHERE QUOCTICH = 'Germany') AND NOT EXISTS (SELECT * FROM Thanhtich WHERE CauThu.ID_CT = Thanhtich.ID_CT) 
